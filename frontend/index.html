<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roadmap ETNA - MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --certeza-comprometido: #2e7d32;
            --certeza-planificado: #1565c0;
            --certeza-exploratorio: #9e9e9e;
            --primary: #003D7A;
            --primary-dark: #002145;
            --primary-light: #0056B3;
            --secondary: #F39C12;
            --bg: #F5F7FA;
            --text: #2C3E50;
            --text-light: #7F8C8D;
            --border: #DDE1E6;
            --white: #FFFFFF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--primary-dark);
            font-weight: 600;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.15);
            border-bottom: 4px solid var(--secondary);
        }

        header h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--white);
            font-weight: 700;
        }

        header button {
            padding: 10px 20px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        header button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        header .spacer {
            flex: 1;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ========= IMPORT VIEW ========= */
        .import-section {
            background: var(--white);
            border-radius: 8px;
            padding: 30px;
            margin: 20px;
            max-width: 600px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
        }

        .import-section h2 {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.3rem;
        }

        /* ========= HOME VIEW STYLES ========= */
        .home-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .home-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .home-header h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .home-header p {
            color: var(--muted);
            font-size: 1.1em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .option-card {
            background: var(--white);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            border-left: 4px solid transparent;
        }

        .option-card:hover {
            box-shadow: 0 8px 24px rgba(0, 61, 122, 0.15);
            border-color: var(--primary);
            border-left-color: var(--secondary);
            transform: translateY(-5px);
        }

        .option-card h3 {
            color: var(--primary);
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .option-card p {
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .option-card .emoji {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .roadmap-list {
            background: var(--white);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .roadmap-list h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .roadmap-item {
            padding: 15px;
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .roadmap-item:hover {
            background: rgba(0, 61, 122, 0.03);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.1);
        }

        .roadmap-item-info h4 {
            margin: 0;
            color: var(--primary);
        }

        .roadmap-item-info p {
            margin: 5px 0 0;
            color: var(--text-light);
            font-size: 0.9em;
        }

        .roadmap-item-actions button {
            padding: 6px 12px;
            margin-left: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s ease;
        }

        .btn-view {
            background: var(--primary);
            color: var(--white);
        }

        .btn-view:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.25);
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted);
        }

        .empty-state p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        /* ========= EDIT VIEW STYLES ========= */
        .edit-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .edit-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .edit-section {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
        }

        .edit-section h3 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--primary);
        }

        .data-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .data-table tr:hover {
            background: rgba(0, 61, 122, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-buttons button {
            padding: 4px 8px;
            font-size: 0.8em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: var(--primary);
            color: var(--white);
        }

        .btn-edit:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.25);
        }

        .btn-remove {
            background: #e74c3c;
            color: white;
        }

        .btn-remove:hover {
            background: #c0392b;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        .add-btn {
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background: var(--secondary);
            color: var(--text);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-btn:hover {
            background: #e8a60b;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.25);
        }

        .edit-footer {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .edit-footer button {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
        }

        .btn-save {
            background: #2e7d32;
            color: white;
        }

        .btn-save:hover {
            background: #1b5e20;
        }

        .btn-cancel {
            background: #9e9e9e;
            color: white;
        }

        .btn-cancel:hover {
            background: #757575;
        }

        @media (max-width: 900px) {
            .edit-sections {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .form-group input[type="file"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 61, 122, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button-group button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.3);
        }

        .btn-secondary {
            background: rgba(243, 156, 18, 0.1);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.25);
        }

        .success, .error {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .success {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border-color: #2ecc71;
        }

        .error {
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            border-color: #e74c3c;
        }

        /* ========= ROADMAP VIEW ========= */
        .timeline-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 8px 16px;
        }

        .timeline-years {
            display: grid;
            grid-template-columns: 220px repeat(5, 4fr);
            font-size: 0.8rem;
            font-weight: 600;
            align-items: center;
            margin-bottom: 2px;
        }

        .timeline-years div {
            text-align: center;
            border-left: 1px solid #eee;
            padding: 2px 0;
        }

        .timeline-years .label {
            text-align: left;
            border: none;
        }

        .timeline-grid {
            display: grid;
            grid-template-columns: 220px repeat(20, 1fr);
            font-size: 0.75rem;
            align-items: center;
        }

        .timeline-grid div {
            text-align: center;
            border-left: 1px dashed #eee;
            padding: 2px 0;
        }

        .timeline-grid .label {
            text-align: left;
            border: none;
            font-weight: 600;
        }

        .roadmap {
            padding: 8px 16px 32px;
        }

        .eje-title {
            margin-top: 32px;
            padding: 8px 0 8px 12px;
            border-left: 4px solid var(--primary);
            border-bottom: 2px solid var(--primary);
            font-weight: 600;
            font-size: 1rem;
            color: var(--primary);
        }

        .iniciativa-row {
            display: grid;
            grid-template-columns: 220px repeat(20, 1fr);
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s ease;
        }

        .iniciativa-row:hover {
            background-color: rgba(0, 61, 122, 0.03);
        }

        .iniciativa-name {
            text-align: left;
            padding-right: 10px;
            font-size: 0.85rem;
            color: var(--text);
        }

        .iniciativa-bar {
            height: 24px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            margin: 0 1px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .iniciativa-bar:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .certeza-comprometido {
            background-color: var(--certeza-comprometido);
        }

        .certeza-planificado {
            background-color: var(--certeza-planificado);
        }

        .certeza-exploratorio {
            background-color: var(--certeza-exploratorio);
        }

        .legend {
            background: var(--white);
            padding: 16px;
            margin: 16px;
            border-radius: 4px;
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
        }

        .legend h3 {
            margin-bottom: 8px;
            color: var(--primary);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text);
        }

        .legend-box {
            width: 24px;
            height: 24px;
            border-radius: 2px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: var(--muted);
        }

        /* ========= MODAL STYLES ========= */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 61, 122, 0.2);
            border-top: 4px solid var(--secondary);
        }

        .modal h2 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .modal-field {
            margin-bottom: 15px;
        }

        .modal-field label {
            font-weight: 600;
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        .modal-field value {
            color: var(--text);
            line-height: 1.5;
        }

        .modal-field ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .modal-field li {
            margin-bottom: 5px;
            color: var(--text);
        }

        .modal-close {
            float: right;
            cursor: pointer;
            font-size: 28px;
            color: var(--text-light);
            line-height: 1;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        /* ========= DEPENDENCY VISUALIZATION ========= */
        .iniciativa-row.dimmed {
            opacity: 0.3;
        }

        .iniciativa-row.highlighted {
            opacity: 1;
            background-color: rgba(255, 200, 200, 0.2);
        }

        .iniciativa-bar.highlighted-bar {
            background-color: #ff6b6b !important;
            box-shadow: 0 0 8px rgba(255, 107, 107, 0.6);
        }

        /* ========= DATABASE CONFIGURATION VIEW ========= */
        .db-config-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .db-config-container {
                grid-template-columns: 1fr;
            }
        }

        .db-config-card {
            background: var(--white);
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
        }

        .db-config-card h2 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .db-config-card > p {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .db-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border);
        }

        .db-tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            margin-bottom: -2px;
        }

        .db-tab:hover {
            color: var(--primary);
        }

        .db-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .db-tab-content {
            display: none;
        }

        .db-tab-content.active {
            display: block;
        }

        .db-form-group {
            margin-bottom: 20px;
        }

        .db-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .db-form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .db-form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 61, 122, 0.1);
        }

        .db-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-connect,
        .btn-json {
            width: 100%;
            padding: 14px;
            margin-top: 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-connect {
            background: var(--primary);
            color: var(--white);
        }

        .btn-connect:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(0, 61, 122, 0.3);
        }

        .btn-json {
            background: var(--secondary);
            color: var(--text);
            border: 1px solid var(--secondary);
        }

        .btn-json:hover {
            background: rgba(243, 156, 18, 0.1);
            border-color: var(--secondary);
        }

        .db-note {
            margin-top: 15px;
            padding: 12px;
            background: rgba(0, 61, 122, 0.05);
            border-left: 3px solid var(--primary);
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--text);
        }

        .db-note a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .db-note a:hover {
            text-decoration: underline;
        }

        #mysqlStatus {
            padding: 12px;
            border-radius: 4px;
            font-weight: 600;
        }

        #mysqlStatus.success {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border: 1px solid #2ecc71;
        }

        #mysqlStatus.error {
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            border: 1px solid #e74c3c;
        }

        .db-info {
            padding: 20px;
            background: rgba(0, 61, 122, 0.05);
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .db-info h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .db-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .db-info li {
            margin-bottom: 8px;
            color: var(--text);
        }

        .db-status-panel {
            background: var(--white);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--secondary);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .db-status-panel h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .status-badge.connected {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .status-badge.disconnected {
            background: rgba(149, 165, 166, 0.1);
            color: #7f8c8d;
        }

        .status-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-badge.connected .status-dot {
            background-color: #2ecc71;
        }

        .status-badge.disconnected .status-dot {
            background-color: #95a5a6;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .storage-info {
            padding: 12px;
            background: rgba(0, 61, 122, 0.05);
            border-radius: 4px;
            border-left: 3px solid var(--primary);
        }

        .storage-info p {
            margin: 8px 0;
            color: var(--text);
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <!-- ========= MODAL ========= -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <span class="modal-close" onclick="closeInitiativaModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- ========= DATABASE CONNECTION VIEW ========= -->
    <div id="dbConfigView" class="view active">
        <header>
            <h1>‚öôÔ∏è Configuraci√≥n de Base de Datos</h1>
        </header>
        <div class="db-config-container">
            <div class="db-config-card">
                <h2>Selecciona tu fuente de datos</h2>
                <p>Elige c√≥mo deseas almacenar y acceder a tus roadmaps:</p>

                <div class="db-tabs">
                    <button class="db-tab active" onclick="showDbTab('mysql')">
                        üóÑÔ∏è MySQL
                    </button>
                    <button class="db-tab" onclick="showDbTab('json')">
                        üìÑ JSON
                    </button>
                </div>

                <!-- MySQL Configuration -->
                <div id="mysqlTab" class="db-tab-content active">
                    <div class="db-form-group">
                        <label for="dbHost">Host</label>
                        <input type="text" id="dbHost" placeholder="localhost" value="localhost">
                    </div>

                    <div class="db-form-row">
                        <div class="db-form-group">
                            <label for="dbPort">Puerto</label>
                            <input type="text" id="dbPort" placeholder="3306" value="3306">
                        </div>
                        <div class="db-form-group">
                            <label for="dbName">Base de Datos</label>
                            <input type="text" id="dbName" placeholder="roadmap_mvp" value="roadmap_mvp">
                        </div>
                    </div>

                    <div class="db-form-row">
                        <div class="db-form-group">
                            <label for="dbUser">Usuario</label>
                            <input type="text" id="dbUser" placeholder="root" value="root">
                        </div>
                        <div class="db-form-group">
                            <label for="dbPassword">Contrase√±a</label>
                            <input type="password" id="dbPassword" placeholder="(dejar vac√≠o si no hay)">
                        </div>
                    </div>

                    <div id="mysqlStatus" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>

                    <button class="btn-connect" onclick="connectToMySQL()">
                        Conectar a MySQL
                    </button>

                    <p class="db-note">
                        ‚ÑπÔ∏è Necesitas tener MySQL instalado y corriendo. 
                        <a href="#" onclick="alert('Ver MYSQL_SETUP.md para instrucciones de instalaci√≥n')">Ver instrucciones</a>
                    </p>
                </div>

                <!-- JSON Configuration -->
                <div id="jsonTab" class="db-tab-content">
                    <div class="db-info">
                        <h3>Almacenamiento con JSON</h3>
                        <p>Los datos se guardar√°n en un archivo JSON local. Esta es la opci√≥n m√°s simple y no requiere configuraci√≥n adicional.</p>
                        <p><strong>Ventajas:</strong></p>
                        <ul>
                            <li>Sin dependencias externas</li>
                            <li>F√°cil de transportar</li>
                            <li>Portable entre equipos</li>
                        </ul>
                        <p><strong>Desventajas:</strong></p>
                        <ul>
                            <li>Acceso m√°s lento con muchos datos</li>
                            <li>No v√°lido para m√∫ltiples usuarios simult√°neos</li>
                        </ul>
                    </div>
                    <button class="btn-json" onclick="useJSONStorage()">
                        Usar XML Almacenamiento
                    </button>
                </div>
            </div>

            <div class="db-status-panel">
                <h3>Estado Actual</h3>
                <div id="connectionStatus" class="status-badge disconnected">
                    <span class="status-dot"></span>
                    Desconectado
                </div>
                <div id="storageInfo" class="storage-info" style="display: none;">
                    <p><strong>Almacenamiento:</strong> <span id="storageType">-</span></p>
                    <p><strong>Conexi√≥n:</strong> <span id="connectionString">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ========= HOME VIEW ========= -->
    <div id="homeView" class="view">
        <header>
            <h1>üó∫Ô∏è Roadmap Manager</h1>
        </header>
        <div class="home-container">
            <div class="home-header">
                <h1>Gestor de Roadmaps</h1>
                <p>Crea, importa y gestiona tus roadmaps de forma f√°cil</p>
            </div>

            <div class="options-grid">
                <div class="option-card" onclick="showCreateRoadmapView()">
                    <div class="emoji">‚ûï</div>
                    <h3>Crear Roadmap</h3>
                    <p>Crea un nuevo roadmap desde cero con tus propios ejes e iniciativas.</p>
                </div>
                <div class="option-card" onclick="showImportView()">
                    <div class="emoji">üì•</div>
                    <h3>Importar JSON</h3>
                    <p>Importa un roadmap desde un archivo JSON existente.</p>
                </div>
                <div class="option-card" onclick="showListView()">
                    <div class="emoji">üìã</div>
                    <h3>Ver Existentes</h3>
                    <p>Visualiza y gestiona los roadmaps que ya tienes cargados.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ========= IMPORT VIEW ========= -->
    <div id="importView" class="view">
        <header>
            <button onclick="goToHome()">‚Üê Inicio</button>
            <h1>Importar Roadmap desde JSON</h1>
        </header>
        <div class="import-section">
            <div id="successMsg" class="success" style="display: none;"></div>
            <div id="errorMsg" class="error" style="display: none;"></div>
            
            <div class="form-group">
                <label for="jsonFile">Selecciona archivo JSON</label>
                <input type="file" id="jsonFile" accept=".json" onchange="previewRoadmapJson()">
            </div>

            <div id="jsonPreview" style="display: none; background: #f5f5f5; padding: 12px; border-radius: 4px; margin-bottom: 15px; max-height: 300px; overflow-y: auto; font-size: 0.85em; font-family: monospace; white-space: pre-wrap; word-break: break-all;"></div>

            <div class="form-group">
                <label for="importTitle">T√≠tulo (opcional)</label>
                <input type="text" id="importTitle" placeholder="Si est√° vac√≠o, usar√° el valor de 'producto' del JSON">
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="importRoadmapJson(this)">Importar</button>
                <button class="btn-secondary" onclick="clearJsonImport()">Limpiar</button>
            </div>
        </div>
    </div>

    <!-- ========= LIST VIEW ========= -->
    <div id="listView" class="view">
        <header>
            <button onclick="goToHome()">‚Üê Inicio</button>
            <h1>Mis Roadmaps</h1>
        </header>
        <div class="home-container">
            <div class="roadmap-list">
                <h2>Roadmaps Disponibles</h2>
                <div id="roadmapListContainer"></div>
            </div>
        </div>
    </div>

    <!-- ========= CREATE VIEW ========= -->
    <div id="createView" class="view">
        <header>
            <button onclick="goToHome()">‚Üê Inicio</button>
            <h1>Crear Nuevo Roadmap</h1>
        </header>
        <div class="import-section">
            <div id="createSuccessMsg" class="success" style="display: none;"></div>
            <div id="createErrorMsg" class="error" style="display: none;"></div>
            
            <div class="form-group">
                <label for="newTitle">T√≠tulo del Roadmap</label>
                <input type="text" id="newTitle" placeholder="Ej: Roadmap ETNA 2026">
            </div>

            <div class="form-group">
                <label for="newProducto">Producto</label>
                <input type="text" id="newProducto" placeholder="Ej: ETNA">
            </div>

            <div class="form-group">
                <label for="newOrganizacion">Organizaci√≥n</label>
                <input type="text" id="newOrganizacion" placeholder="Ej: ENAIRE">
            </div>

            <div class="form-group">
                <label for="newInicio">Horizonte - Inicio (YYYY-TQ)</label>
                <input type="text" id="newInicio" placeholder="Ej: 2026-T1">
            </div>

            <div class="form-group">
                <label for="newFin">Horizonte - Fin (YYYY-TQ)</label>
                <input type="text" id="newFin" placeholder="Ej: 2030-T4">
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="createNewRoadmap()">Crear Roadmap</button>
                <button class="btn-secondary" onclick="clearCreateForm()">Limpiar</button>
            </div>
        </div>
    </div>

    <!-- ========= ROADMAP VIEW ========= -->
    <div id="roadmapView" class="view">
        <header>
            <button onclick="goToHome()">‚Üê Inicio</button>
            <div class="spacer"></div>
            <span id="roadmapTitle" style="font-weight: 600; font-size: 1.1em;"></span>
            <div class="spacer"></div>
            <button onclick="editCurrentRoadmap()">‚úèÔ∏è Editar</button>
            <button onclick="downloadRoadmap()">‚¨áÔ∏è Descargar JSON</button>
        </header>

        <h1 id="pageTitle"></h1>

        <div class="legend">
            <h3>Leyenda</h3>
            <div class="legend-item">
                <div class="legend-box certeza-comprometido"></div>
                <span>Comprometido</span>
            </div>
            <div class="legend-item">
                <div class="legend-box certeza-planificado"></div>
                <span>Planificado</span>
            </div>
            <div class="legend-item">
                <div class="legend-box certeza-exploratorio"></div>
                <span>Exploratorio</span>
            </div>
        </div>

        <div class="timeline-header">
            <div class="timeline-years">
                <div class="label">Iniciativas</div>
                <div>2026</div>
                <div>2027</div>
                <div>2028</div>
                <div>2029</div>
                <div>2030</div>
            </div>
            <div class="timeline-grid" id="timelineQuarters"></div>
        </div>

        <div class="roadmap" id="roadmapContent"></div>
    </div>

    <!-- ========= EDIT VIEW ========= -->
    <div id="editView" class="view">
        <header>
            <button onclick="cancelEditRoadmap()">‚Üê Cancelar</button>
            <h1>Editar Roadmap</h1>
        </header>
        <div class="edit-container">
            <div class="edit-sections">
                <!-- Left column: Datos base y Ejes -->
                <div>
                    <div class="edit-section">
                        <h3>Datos Base</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>T√≠tulo</label>
                                <input type="text" id="editTitle" placeholder="T√≠tulo del roadmap">
                            </div>
                            <div class="form-group">
                                <label>Producto</label>
                                <input type="text" id="editProducto" placeholder="Ej: ETNA">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Organizaci√≥n</label>
                                <input type="text" id="editOrganizacion" placeholder="Ej: ENAIRE">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Horizonte Inicio (YYYY-TQ)</label>
                                <input type="text" id="editInicio" placeholder="2026-T1">
                            </div>
                            <div class="form-group">
                                <label>Horizonte Fin (YYYY-TQ)</label>
                                <input type="text" id="editFin" placeholder="2030-T4">
                            </div>
                        </div>
                    </div>

                    <div class="edit-section">
                        <h3>Ejes Estrat√©gicos</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="ejesList"></tbody>
                            </table>
                        </div>
                        <button class="add-btn" onclick="addNewEje()">+ A√±adir Eje</button>
                    </div>
                </div>

                <!-- Right column: Iniciativas -->
                <div>
                    <div class="edit-section">
                        <h3>Iniciativas</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Eje</th>
                                        <th>Inicio</th>
                                        <th>Fin</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="iniciativasList"></tbody>
                            </table>
                        </div>
                        <button class="add-btn" onclick="addNewIniciativa()">+ A√±adir Iniciativa</button>
                    </div>
                </div>
            </div>

            <div class="edit-footer">
                <button class="btn-save" onclick="saveEditedRoadmap()">üíæ Guardar</button>
                <button class="btn-cancel" onclick="cancelEditRoadmap()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- ========= EDIT EJE MODAL ========= -->
    <div id="ejeModalOverlay" class="modal-overlay">
        <div class="modal">
            <span class="modal-close" onclick="closeEjeModal()">&times;</span>
            <h2 id="ejeModalTitle">Nuevo Eje</h2>
            <div class="modal-field">
                <label>ID</label>
                <input type="text" id="ejeModalId" placeholder="Ej: E1">
            </div>
            <div class="modal-field">
                <label>Nombre</label>
                <input type="text" id="ejeModalNombre" placeholder="Nombre del eje">
            </div>
            <div class="modal-field">
                <label>Descripci√≥n</label>
                <textarea id="ejeModalDesc" placeholder="Descripci√≥n" style="min-height: 60px;"></textarea>
            </div>
            <div class="modal-field">
                <label>Color</label>
                <input type="text" id="ejeModalColor" placeholder="#003D7A">
            </div>
            <div class="button-group">
                <button class="btn-primary" onclick="saveEjeModal()">Guardar</button>
                <button class="btn-secondary" onclick="closeEjeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- ========= EDIT INICIATIVA MODAL ========= -->
    <div id="iniciativaModalOverlay" class="modal-overlay">
        <div class="modal" style="max-width: 700px;">
            <span class="modal-close" onclick="closeIniciativaModal()">&times;</span>
            <h2 id="iniciativaModalTitle">Nueva Iniciativa</h2>
            <div class="modal-field">
                <label>Nombre</label>
                <input type="text" id="iniciativaModalNombre" placeholder="Nombre">
            </div>
            <div class="modal-field">
                <label>ID</label>
                <input type="text" id="iniciativaModalId" placeholder="Ej: INIT1">
            </div>
            <div class="form-row">
                <div class="modal-field">
                    <label>Eje</label>
                    <select id="iniciativaModalEje"></select>
                </div>
                <div class="modal-field">
                    <label>Tipo</label>
                    <input type="text" id="iniciativaModalTipo" placeholder="Feature, Bugfix...">
                </div>
            </div>
            <div class="form-row">
                <div class="modal-field">
                    <label>Inicio (YYYY-TQ)</label>
                    <input type="text" id="iniciativaModalInicio" placeholder="2026-T1">
                </div>
                <div class="modal-field">
                    <label>Fin (YYYY-TQ)</label>
                    <input type="text" id="iniciativaModalFin" placeholder="2026-T4">
                </div>
            </div>
            <div class="modal-field">
                <label>Objetivo</label>
                <textarea id="iniciativaModalObjetivo" placeholder="Objetivo" style="min-height: 60px;"></textarea>
            </div>
            <div class="button-group">
                <button class="btn-primary" onclick="saveIniciativaModal()">Guardar</button>
                <button class="btn-secondary" onclick="closeIniciativaModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- ========= SAVE OPTIONS MODAL ========= -->
    <div id="saveModalOverlay" class="modal-overlay">
        <div class="modal">
            <span class="modal-close" onclick="closeSaveModal()">&times;</span>
            <h2>Guardar Roadmap</h2>
            <p style="margin: 15px 0;">¬øC√≥mo deseas guardar los cambios?</p>
            <div class="button-group">
                <button class="btn-primary" onclick="saveOverwriteRoadmap()">Sobreescribir actual</button>
                <button class="btn-secondary" onclick="saveAsNewRoadmap()">Guardar como nuevo</button>
            </div>
        </div>
    </div>

    <script>
        let currentRoadmapData = null;
        let roadmapsStore = [];

        // Vista navigation
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        function goToHome() {
            showView('homeView');
        }

        function showImportView() {
            showView('importView');
            clearJsonImport();
        }

        function showListView() {
            showView('listView');
            loadAndDisplayRoadmaps();
        }

        function showCreateRoadmapView() {
            showView('createView');
            clearCreateForm();
        }

        function goToImport() {
            showView('importView');
            document.getElementById('roadmapView').classList.remove('active');
        }

        // ========= DATABASE CONFIGURATION FUNCTIONS =========

        function showDbTab(tabName) {
            // Hide all tabs
            document.getElementById('mysqlTab').classList.remove('active');
            document.getElementById('jsonTab').classList.remove('active');
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.db-tab').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Mark button as active
            event.target.classList.add('active');
        }

        async function connectToMySQL() {
            const host = document.getElementById('dbHost').value || 'localhost';
            const port = document.getElementById('dbPort').value || '3306';
            const database = document.getElementById('dbName').value || 'roadmap_mvp';
            const username = document.getElementById('dbUser').value || 'root';
            const password = document.getElementById('dbPassword').value || '';

            const statusEl = document.getElementById('mysqlStatus');
            statusEl.style.display = 'block';
            statusEl.textContent = '‚è≥ Conectando...';
            statusEl.classList.remove('success', 'error');

            try {
                const response = await fetch('http://localhost:8081/api/db/connect', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        host: host,
                        port: port,
                        database: database,
                        username: username,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok && data.status === 'connected') {
                    statusEl.textContent = '‚úÖ ' + data.message;
                    statusEl.classList.add('success');
                    
                    // Update status panel
                    const statusBadge = document.getElementById('connectionStatus');
                    statusBadge.classList.remove('disconnected');
                    statusBadge.classList.add('connected');
                    statusBadge.innerHTML = '<span class="status-dot"></span>Conectado a MySQL';
                    
                    const storageInfo = document.getElementById('storageInfo');
                    storageInfo.style.display = 'block';
                    document.getElementById('storageType').textContent = 'MySQL';
                    document.getElementById('connectionString').textContent = host + ':' + port + '/' + database;
                    
                    // Store connection info in localStorage
                    localStorage.setItem('dbConfig', JSON.stringify({
                        type: 'mysql',
                        host: host,
                        port: port,
                        database: database,
                        username: username
                    }));

                    // Go to home after 2 seconds
                    setTimeout(() => goToHome(), 2000);
                } else {
                    statusEl.textContent = '‚ùå ' + (data.error || 'Error en la conexi√≥n');
                    statusEl.classList.add('error');
                }
            } catch (err) {
                statusEl.textContent = '‚ùå Error: ' + err.message;
                statusEl.classList.add('error');
                console.error('Connection error:', err);
            }
        }

        function useJSONStorage() {
            // Store preference in localStorage
            localStorage.setItem('dbConfig', JSON.stringify({
                type: 'json'
            }));

            // Update status panel
            const statusBadge = document.getElementById('connectionStatus');
            statusBadge.classList.remove('disconnected');
            statusBadge.classList.add('connected');
            statusBadge.innerHTML = '<span class="status-dot"></span>Almacenamiento JSON';
            
            const storageInfo = document.getElementById('storageInfo');
            storageInfo.style.display = 'block';
            document.getElementById('storageType').textContent = 'JSON Local';
            document.getElementById('connectionString').textContent = 'roadmap_angular_mvp.json';

            // Go to home after 1 second
            setTimeout(() => goToHome(), 1000);
        }

        function showMessage(msg, type) {
            const msgEl = document.getElementById(type + 'Msg');
            msgEl.textContent = msg;
            msgEl.style.display = 'block';
            setTimeout(() => msgEl.style.display = 'none', 5000);
        }

        function previewRoadmapJson() {
            const file = document.getElementById('jsonFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const json = JSON.parse(e.target.result);
                    document.getElementById('jsonPreview').textContent = JSON.stringify(json, null, 2);
                    document.getElementById('jsonPreview').style.display = 'block';

                    if (json.producto && !document.getElementById('importTitle').value) {
                        document.getElementById('importTitle').value = json.producto;
                    }
                } catch (err) {
                    showMessage('‚ùå JSON inv√°lido: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function importRoadmapJson(btn) {
            const file = document.getElementById('jsonFile').files[0];
            if (!file) {
                showMessage('Selecciona un archivo JSON', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    const title = document.getElementById('importTitle').value.trim() || jsonData.producto || 'Sin t√≠tulo';

                    // Construir datos del roadmap
                    const roadmapData = {
                        id: 'rm-' + Date.now(),
                        title: title,
                        description: jsonData.descripcion || '',
                        producto: jsonData.producto || '',
                        organizacion: jsonData.organizacion || '',
                        createdAt: new Date().toISOString(),
                        horizonte_base: jsonData.horizonte_base || { inicio: '2026-T1', fin: '2030-T4' },
                        ejes_estrategicos: jsonData.ejes_estrategicos || [],
                        iniciativas: jsonData.iniciativas || []
                    };

                    btn.disabled = true;

                    // Guardar en localStorage
                    roadmapsStore.push(roadmapData);
                    localStorage.setItem('roadmaps', JSON.stringify(roadmapsStore));

                    // Tambi√©n enviar al servidor
                    fetch('/api/roadmaps', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(roadmapData)
                    })
                    .then(r => r.json().catch(() => ({})))
                    .catch(err => console.log('Servidor no disponible, usando localStorage'));

                    currentRoadmapData = roadmapData;
                    showMessage('‚úì Roadmap importado correctamente', 'success');
                    setTimeout(() => {
                        renderRoadmap(roadmapData);
                        document.getElementById('importView').classList.remove('active');
                    }, 500);
                } catch (err) {
                    showMessage('‚ùå Error al importar: ' + err.message, 'error');
                }
                btn.disabled = false;
            };
            reader.readAsText(file);
        }

        function clearJsonImport() {
            document.getElementById('jsonFile').value = '';
            document.getElementById('importTitle').value = '';
            document.getElementById('jsonPreview').style.display = 'none';
            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        }

        function renderRoadmap(data) {
            currentRoadmapData = data;
            const title = data.title || data.producto || 'Roadmap';
            
            document.getElementById('roadmapTitle').textContent = title;
            document.getElementById('pageTitle').textContent = `${data.organizacion ? data.organizacion + ' - ' : ''}${title}`;

            renderTimeline(data.horizonte_base);
            renderRoadmapContent(data);

            document.getElementById('importView').classList.remove('active');
            document.getElementById('roadmapView').classList.add('active');
        }

        function renderTimeline(horizonte) {
            const quarters = [];
            const [startYear, startQ] = horizonte.inicio.split('-T').map(x => parseInt(x) || 0);
            const [endYear, endQ] = horizonte.fin.split('-T').map(x => parseInt(x) || 0);

            for (let y = startYear; y <= endYear; y++) {
                const startQuarter = y === startYear ? startQ : 1;
                const endQuarter = y === endYear ? endQ : 4;
                for (let q = startQuarter; q <= endQuarter; q++) {
                    quarters.push(`${y}-T${q}`);
                }
            }

            let html = '<div class="label"></div>';
            quarters.forEach(q => {
                html += `<div>T${q.split('T')[1]}</div>`;
            });
            html += '<br/>';
            html += '<div class="label"></div>';
            quarters.forEach(q => {
                const year = q.split('-')[0];
                html += `<div>${year}</div>`;
            });

            document.getElementById('timelineQuarters').innerHTML = html;
        }

        function renderRoadmapContent(data) {
            const ejes = data.ejes_estrategicos || [];
            const iniciativas = data.iniciativas || [];

            let html = '';

            ejes.forEach(eje => {
                html += `<div class="eje-title" style="border-bottom-color: ${eje.color || '#ddd'};">
                    ${eje.nombre || eje.id}
                </div>`;

                const ejeIniciativas = iniciativas.filter(i => i.eje === eje.id);
                
                if (ejeIniciativas.length === 0) {
                    html += '<div style="padding: 10px; color: var(--text-light); font-size: 0.9em;">Sin iniciativas</div>';
                } else {
                    ejeIniciativas.forEach(init => {
                        html += renderIniciativaRow(init);
                    });
                }
            });

            document.getElementById('roadmapContent').innerHTML = html;
            attachInitiativeHoverListeners();
        }

        function attachInitiativeHoverListeners() {
            const rows = document.querySelectorAll('.iniciativa-row');
            rows.forEach(row => {
                row.addEventListener('mouseenter', () => {
                    const initiativeId = row.getAttribute('data-initiative-id');
                    highlightDependencies(initiativeId);
                });
                row.addEventListener('mouseleave', () => {
                    clearDependencyHighlight();
                });
            });
        }

        function highlightDependencies(initiativeId) {
            const initiative = findInitiativeById(initiativeId);
            if (!initiative || !initiative.dependencias)
                return;
            const rows = document.querySelectorAll('.iniciativa-row');
            const dependentIds = new Set();
            
            // Encuentra todas las iniciativas que dependen de esta
            currentRoadmapData.iniciativas.forEach(init => {
                if (init.dependencias && init.dependencias.length > 0) {
                    init.dependencias.forEach(dep => {
                        if (dep.iniciativa === initiativeId) {
                            dependentIds.add(init.id);
                        }
                    });
                }
            });
            
            rows.forEach(row => {
                const id = row.getAttribute('data-initiative-id');
                if (id === initiativeId) {
                    row.classList.add('highlighted');
                } else if (dependentIds.has(id)) {
                    row.classList.add('highlighted');
                } else {
                    row.classList.add('dimmed');
                }
            });
        }

        function clearDependencyHighlight() {
            const rows = document.querySelectorAll('.iniciativa-row');
            rows.forEach(row => {
                row.classList.remove('dimmed', 'highlighted');
            });
        }

        function findInitiativeById(id) {
            if (!currentRoadmapData) return null;
            return currentRoadmapData.iniciativas.find(init => init.id === id);
        }

        function showInitiativaModal(initiativeId) {
            const initiative = findInitiativeById(initiativeId);
            if (!initiative) return;
            
            const dependenciasHtml = initiative.dependencias && initiative.dependencias.length > 0
                ? initiative.dependencias.map(dep => `<li>${dep.iniciativa} (${dep.tipo})`).join('')
                : '<li>No tiene dependencias</li>';
            
            const modalContent = `
                <h2>${initiative.nombre}</h2>
                <div class="modal-field">
                    <label>ID:</label>
                    <value>${initiative.id}</value>
                </div>
                <div class="modal-field">
                    <label>Descripci√≥n / Objetivo:</label>
                    <value>${initiative.objetivo || 'Sin descripci√≥n'}</value>
                </div>
                <div class="modal-field">
                    <label>Tipo:</label>
                    <value>${initiative.tipo || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Expediente:</label>
                    <value>${initiative.expediente || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Periode (Inicio - Fin):</label>
                    <value>${initiative.inicio || 'N/A'} - ${initiative.fin || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Impacto Principal:</label>
                    <value>${initiative.impacto_principal || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Usuarios Afectados:</label>
                    <value>${initiative.usuarios_afectados || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Certeza:</label>
                    <value>${initiative.certeza || 'N/A'}</value>
                </div>
                <div class="modal-field">
                    <label>Dependencias:</label>
                    <ul>${dependenciasHtml}</ul>
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeInitiativaModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeInitiativaModal();
        });

        function renderIniciativaRow(init) {
            const inicio = init.inicio || '2026-T1';
            const fin = init.fin || '2026-T4';
            const certeza = init.certeza || 'planificado';

            const [inicioYear, inicioQ] = inicio.split('-T').map(x => parseInt(x) || 0);
            const [finYear, finQ] = fin.split('-T').map(x => parseInt(x) || 0);

            let html = `<div class="iniciativa-row" data-initiative-id="${init.id}" onclick="showInitiativaModal('${init.id}')" style="cursor: pointer;">
                <div class="iniciativa-name" title="${init.nombre}">
                    <strong>${init.nombre}</strong><br/>
                    <small style="color: var(--muted);">${init.expediente || ''}</small>
                </div>`;

            // Timeline cells
            for (let i = 0; i < 20; i++) {
                const quarterNum = (i % 4) + 1;
                const year = 2026 + Math.floor(i / 4);
                const currentQ = `${year}-T${quarterNum}`;

                // Check if this quarter is in range
                let isInRange = false;
                if (year > inicioYear && year < finYear) {
                    isInRange = true;
                } else if (year === inicioYear && quarterNum >= inicioQ) {
                    isInRange = true;
                } else if (year === finYear && quarterNum <= finQ) {
                    isInRange = true;
                }

                if (isInRange) {
                    html += `<div class="iniciativa-bar certeza-${certeza}" title="${init.nombre}"></div>`;
                } else {
                    html += '<div></div>';
                }
            }

            html += '</div>';
            return html;
        }

        function downloadRoadmap() {
            if (!currentRoadmapData) return;
            const json = JSON.stringify(currentRoadmapData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = (currentRoadmapData.producto || 'roadmap') + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ========= NEW ROADMAP MANAGEMENT =========
        function createNewRoadmap() {
            const title = document.getElementById('newTitle').value;
            const producto = document.getElementById('newProducto').value;
            const organizacion = document.getElementById('newOrganizacion').value;
            const inicio = document.getElementById('newInicio').value;
            const fin = document.getElementById('newFin').value;

            if (!title || !producto || !organizacion || !inicio || !fin) {
                showMessage('Por favor completa todos los campos', 'create');
                return;
            }

            const newRoadmap = {
                id: 'rm-' + Date.now(),
                title: title,
                description: '',
                producto: producto,
                organizacion: organizacion,
                createdAt: new Date().toISOString(),
                horizonte_base: { inicio, fin },
                ejes_estrategicos: [],
                iniciativas: []
            };

            roadmapsStore.push(newRoadmap);
            localStorage.setItem('roadmaps', JSON.stringify(roadmapsStore));
            
            currentRoadmapData = newRoadmap;
            showMessage('Roadmap creado correctamente', 'createSuccess');
            
            setTimeout(() => {
                document.getElementById('roadmapView').classList.add('active');
                document.getElementById('createView').classList.remove('active');
                renderRoadmap(newRoadmap);
            }, 1500);
        }

        function clearCreateForm() {
            document.getElementById('newTitle').value = '';
            document.getElementById('newProducto').value = '';
            document.getElementById('newOrganizacion').value = '';
            document.getElementById('newInicio').value = '2026-T1';
            document.getElementById('newFin').value = '2030-T4';
            document.getElementById('createErrorMsg').style.display = 'none';
            document.getElementById('createSuccessMsg').style.display = 'none';
        }

        function loadAndDisplayRoadmaps() {
            const stored = localStorage.getItem('roadmaps');
            roadmapsStore = stored ? JSON.parse(stored) : [];

            const container = document.getElementById('roadmapListContainer');
            
            if (roadmapsStore.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay roadmaps cargados a√∫n.</p><p>Crea uno nuevo o importa desde JSON.</p></div>';
                return;
            }

            let html = '';
            roadmapsStore.forEach(rm => {
                html += `
                    <div class="roadmap-item">
                        <div class="roadmap-item-info">
                            <h4>${rm.title}</h4>
                            <p>${rm.producto} - ${rm.organizacion}</p>
                            <p>Ejes: ${rm.ejes_estrategicos ? rm.ejes_estrategicos.length : 0} | Iniciativas: ${rm.iniciativas ? rm.iniciativas.length : 0}</p>
                        </div>
                        <div class="roadmap-item-actions">
                            <button class="btn-view" onclick="viewRoadmap('${rm.id}')">Ver</button>
                            <button class="btn-edit" onclick="editRoadmapFromList('${rm.id}')">Editar</button>
                            <button class="btn-delete" onclick="deleteRoadmap('${rm.id}')">Eliminar</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function viewRoadmap(id) {
            const roadmap = roadmapsStore.find(r => r.id === id);
            if (!roadmap) return;
            
            currentRoadmapData = roadmap;
            showView('roadmapView');
            renderRoadmap(roadmap);
        }

        function deleteRoadmap(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este roadmap?')) {
                roadmapsStore = roadmapsStore.filter(r => r.id !== id);
                localStorage.setItem('roadmaps', JSON.stringify(roadmapsStore));
                loadAndDisplayRoadmaps();
            }
        }

        // ========= EDIT ROADMAP FUNCTIONS =========
        let editingRoadmap = null;
        let editingEjeIndex = null;
        let editingIniciativaIndex = null;

        function editCurrentRoadmap() {
            if (!currentRoadmapData) return;
            editingRoadmap = JSON.parse(JSON.stringify(currentRoadmapData));
            loadEditForm();
            showView('editView');
        }

        function editRoadmapFromList(id) {
            const roadmap = roadmapsStore.find(r => r.id === id);
            if (!roadmap) return;
            currentRoadmapData = roadmap;
            editingRoadmap = JSON.parse(JSON.stringify(roadmap));
            loadEditForm();
            showView('editView');
        }

        function loadEditForm() {
            document.getElementById('editTitle').value = editingRoadmap.title || '';
            document.getElementById('editProducto').value = editingRoadmap.producto || '';
            document.getElementById('editOrganizacion').value = editingRoadmap.organizacion || '';
            document.getElementById('editInicio').value = editingRoadmap.horizonte_base?.inicio || '2026-T1';
            document.getElementById('editFin').value = editingRoadmap.horizonte_base?.fin || '2030-T4';
            
            renderEjesList();
            renderIniciativasList();
        }

        function renderEjesList() {
            const tbody = document.getElementById('ejesList');
            if (!editingRoadmap.ejes_estrategicos || editingRoadmap.ejes_estrategicos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--text-light);">No hay ejes a√∫n</td></tr>';
                return;
            }
            
            let html = '';
            editingRoadmap.ejes_estrategicos.forEach((eje, idx) => {
                html += `
                    <tr>
                        <td>${eje.id || ''}</td>
                        <td>${eje.nombre || ''}</td>
                        <td class="action-buttons">
                            <button class="btn-edit" onclick="editEje(${idx})">Editar</button>
                            <button class="btn-remove" onclick="removeEje(${idx})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderIniciativasList() {
            const tbody = document.getElementById('iniciativasList');
            if (!editingRoadmap.iniciativas || editingRoadmap.iniciativas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-light);">No hay iniciativas a√∫n</td></tr>';
                return;
            }
            
            let html = '';
            editingRoadmap.iniciativas.forEach((init, idx) => {
                html += `
                    <tr>
                        <td>${init.nombre || ''}</td>
                        <td>${init.eje || ''}</td>
                        <td>${init.inicio || ''}</td>
                        <td>${init.fin || ''}</td>
                        <td class="action-buttons">
                            <button class="btn-edit" onclick="editIniciativa(${idx})">Editar</button>
                            <button class="btn-remove" onclick="removeIniciativa(${idx})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function addNewEje() {
            editingEjeIndex = null;
            document.getElementById('ejeModalTitle').textContent = 'Nuevo Eje';
            document.getElementById('ejeModalId').value = '';
            document.getElementById('ejeModalNombre').value = '';
            document.getElementById('ejeModalDesc').value = '';
            document.getElementById('ejeModalColor').value = '#003D7A';
            document.getElementById('ejeModalOverlay').classList.add('active');
        }

        function editEje(idx) {
            editingEjeIndex = idx;
            const eje = editingRoadmap.ejes_estrategicos[idx];
            document.getElementById('ejeModalTitle').textContent = 'Editar Eje';
            document.getElementById('ejeModalId').value = eje.id || '';
            document.getElementById('ejeModalNombre').value = eje.nombre || '';
            document.getElementById('ejeModalDesc').value = eje.descripcion || '';
            document.getElementById('ejeModalColor').value = eje.color || '#003D7A';
            document.getElementById('ejeModalOverlay').classList.add('active');
        }

        function saveEjeModal() {
            const eje = {
                id: document.getElementById('ejeModalId').value,
                nombre: document.getElementById('ejeModalNombre').value,
                descripcion: document.getElementById('ejeModalDesc').value,
                color: document.getElementById('ejeModalColor').value
            };
            
            if (!eje.id || !eje.nombre) {
                alert('ID y Nombre son requeridos');
                return;
            }
            
            if (editingEjeIndex !== null) {
                editingRoadmap.ejes_estrategicos[editingEjeIndex] = eje;
            } else {
                if (!editingRoadmap.ejes_estrategicos) editingRoadmap.ejes_estrategicos = [];
                editingRoadmap.ejes_estrategicos.push(eje);
            }
            
            closeEjeModal();
            renderEjesList();
        }

        function removeEje(idx) {
            if (confirm('¬øEliminar este eje?')) {
                editingRoadmap.ejes_estrategicos.splice(idx, 1);
                renderEjesList();
            }
        }

        function closeEjeModal() {
            document.getElementById('ejeModalOverlay').classList.remove('active');
            editingEjeIndex = null;
        }

        function addNewIniciativa() {
            editingIniciativaIndex = null;
            document.getElementById('iniciativaModalTitle').textContent = 'Nueva Iniciativa';
            document.getElementById('iniciativaModalNombre').value = '';
            document.getElementById('iniciativaModalId').value = '';
            document.getElementById('iniciativaModalTipo').value = '';
            document.getElementById('iniciativaModalInicio').value = '2026-T1';
            document.getElementById('iniciativaModalFin').value = '2026-T4';
            document.getElementById('iniciativaModalObjetivo').value = '';
            populateEjeSelect();
            document.getElementById('iniciativaModalOverlay').classList.add('active');
        }

        function editIniciativa(idx) {
            editingIniciativaIndex = idx;
            const init = editingRoadmap.iniciativas[idx];
            document.getElementById('iniciativaModalTitle').textContent = 'Editar Iniciativa';
            document.getElementById('iniciativaModalNombre').value = init.nombre || '';
            document.getElementById('iniciativaModalId').value = init.id || '';
            document.getElementById('iniciativaModalTipo').value = init.tipo || '';
            document.getElementById('iniciativaModalInicio').value = init.inicio || '2026-T1';
            document.getElementById('iniciativaModalFin').value = init.fin || '2026-T4';
            document.getElementById('iniciativaModalObjetivo').value = init.objetivo || '';
            populateEjeSelect();
            document.getElementById('iniciativaModalEje').value = init.eje || '';
            document.getElementById('iniciativaModalOverlay').classList.add('active');
        }

        function populateEjeSelect() {
            const select = document.getElementById('iniciativaModalEje');
            select.innerHTML = '';
            if (editingRoadmap.ejes_estrategicos) {
                editingRoadmap.ejes_estrategicos.forEach(eje => {
                    const option = document.createElement('option');
                    option.value = eje.id;
                    option.textContent = eje.nombre;
                    select.appendChild(option);
                });
            }
        }

        function saveIniciativaModal() {
            const init = {
                id: document.getElementById('iniciativaModalId').value,
                nombre: document.getElementById('iniciativaModalNombre').value,
                eje: document.getElementById('iniciativaModalEje').value,
                tipo: document.getElementById('iniciativaModalTipo').value,
                inicio: document.getElementById('iniciativaModalInicio').value,
                fin: document.getElementById('iniciativaModalFin').value,
                objetivo: document.getElementById('iniciativaModalObjetivo').value,
                expediente: '',
                impacto_principal: '',
                usuarios_afectados: '',
                dependencias: [],
                certeza: 'planificado'
            };
            
            if (!init.id || !init.nombre) {
                alert('ID y Nombre son requeridos');
                return;
            }
            
            if (editingIniciativaIndex !== null) {
                editingRoadmap.iniciativas[editingIniciativaIndex] = init;
            } else {
                if (!editingRoadmap.iniciativas) editingRoadmap.iniciativas = [];
                editingRoadmap.iniciativas.push(init);
            }
            
            closeIniciativaModal();
            renderIniciativasList();
        }

        function removeIniciativa(idx) {
            if (confirm('¬øEliminar esta iniciativa?')) {
                editingRoadmap.iniciativas.splice(idx, 1);
                renderIniciativasList();
            }
        }

        function closeIniciativaModal() {
            document.getElementById('iniciativaModalOverlay').classList.remove('active');
            editingIniciativaIndex = null;
        }

        function saveEditedRoadmap() {
            // Update from form
            editingRoadmap.title = document.getElementById('editTitle').value;
            editingRoadmap.producto = document.getElementById('editProducto').value;
            editingRoadmap.organizacion = document.getElementById('editOrganizacion').value;
            editingRoadmap.horizonte_base = {
                inicio: document.getElementById('editInicio').value,
                fin: document.getElementById('editFin').value
            };
            
            if (!editingRoadmap.title || !editingRoadmap.producto) {
                alert('T√≠tulo y Producto son requeridos');
                return;
            }
            
            document.getElementById('saveModalOverlay').classList.add('active');
        }

        function saveOverwriteRoadmap() {
            currentRoadmapData = editingRoadmap;
            const idx = roadmapsStore.findIndex(r => r.id === editingRoadmap.id);
            if (idx >= 0) {
                roadmapsStore[idx] = editingRoadmap;
            }
            localStorage.setItem('roadmaps', JSON.stringify(roadmapsStore));
            closeSaveModal();
            showView('roadmapView');
            renderRoadmap(editingRoadmap);
            alert('Roadmap actualizado correctamente');
        }

        function saveAsNewRoadmap() {
            const newRoadmap = JSON.parse(JSON.stringify(editingRoadmap));
            newRoadmap.id = 'rm-' + Date.now();
            newRoadmap.createdAt = new Date().toISOString();
            roadmapsStore.push(newRoadmap);
            localStorage.setItem('roadmaps', JSON.stringify(roadmapsStore));
            closeSaveModal();
            showView('roadmapView');
            currentRoadmapData = newRoadmap;
            renderRoadmap(newRoadmap);
            alert('Nuevo roadmap creado correctamente');
        }

        function closeSaveModal() {
            document.getElementById('saveModalOverlay').classList.remove('active');
        }

        function cancelEditRoadmap() {
            if (confirm('¬øDescartar cambios?')) {
                showView('roadmapView');
            }
        }

        // Load roadmaps from localStorage on page load
        window.addEventListener('load', () => {
            const stored = localStorage.getItem('roadmaps');
            roadmapsStore = stored ? JSON.parse(stored) : [];
        });
    </script>
</body>
</html>
